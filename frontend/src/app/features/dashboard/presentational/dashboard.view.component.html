<section class="app-page__header">
  <div>
    <div class="app-page__title">Overview</div>
    <div class="app-page__subtitle">
      Resumen general de tu flujo financiero y decisiones del mes.
    </div>
  </div>
  <div class="d-flex flex-wrap align-items-center gap-2">
    <div class="app-pill"></div>
    <button class="app-btn-primary">
      <i class="bi bi-download me-2"></i>
      Exportar reporte
    </button>
  </div>
</section>

<section class="app-grid app-grid--three mb-4">
  <div class="app-card app-card--gradient">
    <div class="app-stat__label">{{ getSpendableLabel() }}</div>
    <div class="app-stat">
      <div class="app-stat__value">
      </div>
      <span class="app-chip app-chip--success">
        <i class="bi bi-arrow-up"></i>
          %
      </span>
    </div>
    <p class="text-muted mt-2 mb-0">
      Fórmula: Ingreso - Gastos Fijos - Ahorro. Disponible hoy sin comprometer metas.
    </p>
  </div>

  <div class="app-card">
    <div class="d-flex align-items-start justify-content-between">
      <div>
        <div class="app-stat__label">Ingreso Total</div>
        <!-- TODO: 
         <div class="fs-3 fw-semibold">
          {{ user().incomeTotal | currency: user().currency:'symbol':'1.0-2' }}
        </div> -->
      </div>
      <span class="app-icon-pill"><i class="bi bi-wallet2"></i></span>
    </div>
    <div class="mt-3">
      <div class="progress bg-surface-2" style="height: 6px;">
        <div class="progress-bar bg-primary" style="width: 100%"></div>
      </div>
    </div>
  </div>

  <div class="app-card">
    <div class="d-flex align-items-start justify-content-between">
      <div>
        <div class="app-stat__label">Gastos Fijos</div>
        <!-- TODO
         <div class="fs-3 fw-semibold">
          {{ user().fixedExpenses | currency: 'USD':'symbol':'1.0-2' }}
        </div> -->
      </div>
      <span class="app-icon-pill text-danger border-danger" style="background: rgba(239,68,68,0.12);">
        <i class="bi bi-receipt"></i>
      </span>
    </div>
    <div class="mt-3">
      <div class="progress bg-surface-2" style="height: 6px;">
        <div class="progress-bar bg-danger" style="width: 65%"></div>
      </div>
    </div>
  </div>

  <div class="app-card">
    <div class="d-flex align-items-center justify-content-between">
      <div class="app-stat__label">Meta de Ahorro</div>
      <span class="app-pill app-pill--success">49.8%</span>
    </div>
    <div class="mt-3">
      <div class="fw-semibold">{{ user().savingGoals[0].name || 'Meta de ahorro' }}</div>
      <div class="text-muted">
        {{ user().currentTotalSavings | currency: 'USD':'symbol':'1.0-0' }}
        de
        {{ user().savingGoals[0].targetAmount | currency: 'USD':'symbol':'1.0-0' }}
      </div>
      <div class="progress bg-surface-2 mt-3" style="height: 10px;">
        <div class="progress-bar" style="width: 49.8%"></div>
      </div>
      <div class="text-muted-2 mt-2">Proyección: Dic 2026</div>
    </div>
  </div>
</section>

<section class="app-grid app-grid--dash">
  <div class="d-flex flex-column gap-4">
    <div class="app-card">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="fw-semibold">
          <i class="bi bi-graph-up me-2 text-primary"></i>
          Tendencia de gastos
        </div>
        <select class="app-select" style="max-width: 180px;">
          <option>Últimos 6 meses</option>
          <option>Último año</option>
        </select>
      </div>
      <div class="app-chart">
        <svg viewBox="0 0 800 200" preserveAspectRatio="none">
          <defs>
            <linearGradient id="trendGradient" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="#2b6cee" stop-opacity="0.35"></stop>
              <stop offset="100%" stop-color="#2b6cee" stop-opacity="0"></stop>
            </linearGradient>
          </defs>
          <path d="M0,150 C120,140 150,100 220,120 C320,140 360,70 460,90 C560,110 620,40 800,60 V200 H0 Z"
            fill="url(#trendGradient)"></path>
          <path d="M0,150 C120,140 150,100 220,120 C320,140 360,70 460,90 C560,110 620,40 800,60" fill="none"
            stroke="#2b6cee" stroke-width="3" stroke-linecap="round"></path>
        </svg>
      </div>
    </div>

    <div class="app-grid app-grid--two">
      <div class="app-card">
        <div class="fw-semibold mb-3">
          <i class="bi bi-pie-chart me-2 text-primary"></i>
          Gastos por categoría
        </div>
        <div class="d-flex align-items-center gap-4">
          <div class="app-donut" [style.background]="buildPieGradient()">
            <div class="app-donut__center">Feb</div>
          </div>
          <div class="flex-grow-1">
            <div class="d-flex align-items-center justify-content-between mb-2"
              *ngFor="let category of transactionCategories()">
              <div class="d-flex align-items-center gap-2">
                <span class="app-dot" [style.background]="category.category.color"></span>
                <span class="text-muted">{{ category.category.name }}</span>
              </div>
              <span class="fw-semibold">
                {{ category.amount | currency: 'USD':'symbol':'1.0-0' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="app-card">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="fw-semibold">Transacciones recientes</div>
          <a class="text-primary" href="#">Ver todo</a>
        </div>
        <div class="d-flex flex-column gap-3">
          <!--- TODO: slice temporal -->
          <div class="d-flex align-items-center gap-3 p-2 rounded-3 bg-surface-2 border-subtle"
            *ngFor="let tx of transactions().value() | slice:0:5">
            <span class="app-icon-pill" [class.bg-success]="tx.status === TransactionStatus.CONFIRMED">
              <i class="bi" [ngClass]="tx.category.icon"></i>
            </span>
            <div class="flex-grow-1">
              <div class="fw-semibold">{{ tx.description }}</div>
              <div class="text-muted-2" style="font-size: 0.75rem;">{{ tx.date }}</div>
            </div>
            <div class="fw-semibold">
              {{ tx.amount | currency: 'USD':'symbol':'1.0-2' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="app-card">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="fw-semibold">Tabla editable</div>
        <div class="d-flex gap-2">
          <button class="app-btn-ghost">Filtros</button>
          <button class="app-btn-ghost">Ordenar</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="app-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Comercio</th>
              <th>Categoría</th>
              <th class="text-end">Monto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tx of transactions().value()">
              <td>{{ tx.date }}</td>
              <td>{{ tx.description }}</td>
              <td><span class="app-pill">{{ tx.category.name }}</span></td>
              <td class="text-end fw-semibold">
                {{ tx.amount | currency: 'USD':'symbol':'1.0-2' }}
              </td>
            </tr>
            <tr class="bg-surface-2">
              <td><input class="app-input" value="20 Feb 2026" /></td>
              <td><input class="app-input" value="Unknown Merchant 1002" /></td>
              <td>
                <button class="app-btn-ghost w-100 d-flex align-items-center justify-content-between">
                  Seleccionar categoría <i class="bi bi-chevron-down"></i>
                </button>
              </td>
              <td class="text-end"><input class="app-input text-end" value="$210.00" /></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="d-flex flex-column gap-4">
    <div class="app-card app-card--gradient">
      <div class="fw-semibold mb-3">
        <i class="bi bi-stars me-2 text-primary"></i>
        Smart Ingestion
      </div>
      <div class="app-dropzone">
        <div class="app-dropzone__icon">
          <i class="bi bi-cloud-upload"></i>
        </div>
        <div class="fw-semibold">Arrastra tu estado de cuenta</div>
        <div class="text-muted-2">PDF, JPG o PNG · Máx 25MB</div>
      </div>
    </div>

    <div class="app-card">
      <div class="fw-semibold mb-3">Carga manual rápida</div>
      <form class="d-flex flex-column gap-3" [formGroup]="manualTransactionFormGroup()!" (ngSubmit)="onSubmit()">
        <div>
          <label class="app-section-title" for="descriptionInput">Descripción</label>
          <input id="descriptionInput" class="app-input" placeholder="Ej: Cena en restaurante" type="text" formControlName="description" />
        </div>
        <div>
          <label class="app-section-title" for="amountInput">Monto</label>
          <div class="position-relative">
            <span class="position-absolute top-50 start-0 translate-middle-y ms-3 text-muted">$</span>
            <input id="amountInput" class="app-input ps-4" placeholder="0.00" type="number" formControlName="amount" />
          </div>
        </div>
        <div>
          <label class="app-section-title" for="categorySelect">Categoría</label>
          <select class="app-select" id="categorySelect" formControlName="categoryId">
            <option *ngFor="let category of categories()" [value]="category.id">{{ category.name }}</option>
          </select>
        </div>
        <div>
          <label class="app-section-title" for="dateInput">Fecha</label>
          <input id="dateInput" class="app-input" type="date" formControlName="date" />
        </div>
        <button class="app-btn-primary" type="submit">Agregar gasto</button>
      </form>
    </div>

    <!-- <div class="app-card">
      <div class="fw-semibold mb-3">Presupuesto semanal</div>
      <div class="d-flex align-items-end gap-2 mb-2">
        <div class="fs-3 fw-semibold">
          {{ transactions().weeklyBudgetUsed | currency: transactions().currency:'symbol':'1.0-0' }}
        </div>
        <div class="text-muted">/ {{ transactions().weeklyBudgetTotal | currency: transactions().currency:'symbol':'1.0-0' }}</div>
      </div>
      <div class="progress bg-surface-2 mb-2" style="height: 8px;">
        <div class="progress-bar bg-success"
          [style.width]="(transactions().weeklyBudgetUsed / transactions().weeklyBudgetTotal) * 100 + '%'"></div>
      </div>
      <div class="text-muted-2 text-end">64% usado · 3 días restantes</div>
    </div> -->
  </div>
</section>
