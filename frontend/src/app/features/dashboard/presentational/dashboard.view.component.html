<section class="app-page__header">
  <div>
    <div class="app-page__title">Overview</div>
    <div class="app-page__subtitle">
      Resumen general de tu flujo financiero y decisiones del mes.
    </div>
  </div>
  <div class="d-flex flex-wrap align-items-center gap-2">
    <button class="app-btn-primary">
      <i class="bi bi-download me-2"></i>
      Exportar reporte
    </button>
  </div>
</section>

<section class="app-grid app-grid--three mb-4">
  <div class="app-card app-card--gradient dashboard-card">
    <div class="app-stat__label">{{ getSpendableLabel() }}</div>
    <div class="app-stat">
      <div class="app-stat__value">
      </div>
      <span class="app-chip app-chip--success">
        <i class="bi bi-arrow-up"></i>
          %
      </span>
    </div>
    <p class="text-muted mt-2 mb-0">
      Fórmula: Ingreso - Gastos Fijos - Ahorro. Disponible hoy sin comprometer metas.
    </p>
  </div>

  <div class="app-card dashboard-card">
    <div class="d-flex align-items-start justify-content-between">
      <div>
        <div class="app-stat__label">Ingreso Total</div>
        <!-- TODO: 
         <div class="fs-3 fw-semibold">
          {{ user().incomeTotal | currency: user().currency:'symbol':'1.0-2' }}
        </div> -->
      </div>
      <span class="app-icon-pill"><i class="bi bi-wallet2"></i></span>
    </div>
    <div class="mt-3">
      <div class="progress dashboard-progress" style="height: 6px;">
        <div class="progress-bar bg-primary" style="width: 100%"></div>
      </div>
    </div>
  </div>

  <div class="app-card dashboard-card">
    <div class="d-flex align-items-start justify-content-between">
      <div>
        <div class="app-stat__label">Gastos Fijos</div>
        <!-- TODO
         <div class="fs-3 fw-semibold">
          {{ user().fixedExpenses | currency: 'USD':'symbol':'1.0-2' }}
        </div> -->
      </div>
      <span class="app-icon-pill text-danger border-danger" style="background: rgba(239,68,68,0.12);">
        <i class="bi bi-receipt"></i>
      </span>
    </div>
    <div class="mt-3">
      <div class="progress dashboard-progress" style="height: 6px;">
        <div class="progress-bar bg-danger" style="width: 65%"></div>
      </div>
    </div>
  </div>

  <div class="app-card dashboard-card">
    <div class="d-flex align-items-center justify-content-between">
      <div class="app-stat__label">Meta de Ahorro</div>
      <span class="app-pill app-pill--success">49.8%</span>
    </div>
    <div class="mt-3">
      <div class="fw-semibold">{{ user().savingGoals[0].name || 'Meta de ahorro' }}</div>
      <div class="text-muted">
        {{ user().currentTotalSavings | currency: 'USD':'symbol':'1.0-0' }}
        de
        {{ user().savingGoals[0].targetAmount | currency: 'USD':'symbol':'1.0-0' }}
      </div>
      <div class="progress dashboard-progress mt-3" style="height: 10px;">
        <div class="progress-bar" style="width: 49.8%"></div>
      </div>
      <div class="text-muted-2 mt-2">Proyección: Dic 2026</div>
    </div>
  </div>
</section>

<section class="app-grid app-grid--dash">
  <div class="d-flex flex-column gap-4">
    <div class="app-card dashboard-card">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="fw-semibold">
          <i class="bi bi-pie-chart me-2 text-primary"></i>
          Gastos por categoría
        </div>
        <span class="app-pill">Distribución actual</span>
      </div>
      <div class="category-spotlight">
        <div class="app-donut app-donut--hero chart-donut-wrap">
          <canvas #categoryChart class="chart-donut-canvas" aria-label="Distribución de gastos por categoría"></canvas>
          <div class="app-donut__center app-donut__center--hero">
            <div class="app-donut__label">Total</div>
            <div class="app-donut__value">{{ getTotalCategoryAmountLabel() }}</div>
          </div>
        </div>
        <div class="category-spotlight__legend">
          <div class="category-row category-row--hero" *ngFor="let category of transactionCategories()">
            <div class="category-row__head">
              <div class="category-row__name-wrap">
                <span class="app-dot" [style.background]="category.category.color"></span>
                <span class="text-muted category-row__name">{{ category.category.name }}</span>
              </div>
              <span class="fw-semibold category-row__amount">
                {{ category.amount | currency: 'USD':'symbol':'1.0-0' }}
              </span>
            </div>
            <div class="category-row__track">
              <div
                class="category-row__fill"
                [style.width.%]="getCategoryPercent(category.amount)"
                [style.background]="category.category.color">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="app-grid app-grid--two">
      <div class="app-card dashboard-card">
        <div class="fw-semibold mb-3">
          <i class="bi bi-graph-up me-2 text-primary"></i>
          Tendencia de gastos
        </div>
        <div class="app-chart app-chart--compact">
          <canvas #trendChart class="chart-line-canvas" aria-label="Tendencia de gastos"></canvas>
        </div>
      </div>

      <div class="app-card dashboard-card">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="fw-semibold">Transacciones recientes</div>
          <a class="text-primary" href="#">Ver todo</a>
        </div>
        <div class="d-flex flex-column gap-3">
          <!--- TODO: slice temporal -->
          <div class="d-flex align-items-center gap-3 p-2 rounded-3 bg-surface-2 border-subtle recent-tx-row"
            *ngFor="let tx of transactions().value() | slice:0:5">
            <span class="app-icon-pill" [class.bg-success]="tx.status === TransactionStatus.CONFIRMED">
              <i>{{ tx.category.icon }}</i>
            </span>
            <div class="flex-grow-1">
              <div class="fw-semibold">{{ tx.description }}</div>
              <div class="text-muted-2" style="font-size: 0.75rem;">{{ tx.date }}</div>
            </div>
            <div class="fw-semibold">
              {{ tx.amount | currency: 'USD':'symbol':'1.0-2' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="app-card dashboard-card">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="fw-semibold">Tabla editable</div>
        <div class="d-flex gap-2">
          <button class="app-btn-ghost">Filtros</button>
          <button class="app-btn-ghost">Ordenar</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="app-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Comercio</th>
              <th>Categoría</th>
              <th class="text-end">Monto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tx of transactions().value()">
              <td>{{ tx.date }}</td>
              <td>{{ tx.description }}</td>
              <td><span class="app-pill">{{ tx.category.name }}</span></td>
              <td class="text-end fw-semibold">
                {{ tx.amount | currency: 'USD':'symbol':'1.0-2' }}
              </td>
            </tr>
            <tr class="bg-surface-2">
              <td><input class="app-input" value="20 Feb 2026" /></td>
              <td><input class="app-input" value="Unknown Merchant 1002" /></td>
              <td>
                <button class="app-btn-ghost w-100 d-flex align-items-center justify-content-between">
                  Seleccionar categoría <i class="bi bi-chevron-down"></i>
                </button>
              </td>
              <td class="text-end"><input class="app-input text-end" value="$210.00" /></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="d-flex flex-column gap-4">
    <div class="app-card app-card--gradient dashboard-card">
      <div class="fw-semibold mb-3">
        <i class="bi bi-stars me-2 text-primary"></i>
        Smart Ingestion
      </div>
      <div class="app-dropzone">
        <div class="app-dropzone__icon">
          <i class="bi bi-cloud-upload"></i>
        </div>
        <div class="fw-semibold">Arrastra tu estado de cuenta</div>
        <div class="text-muted-2">PDF, JPG o PNG · Máx 25MB</div>
      </div>
    </div>

    <div class="app-card dashboard-card">
      <div class="fw-semibold mb-3">Carga manual rápida</div>
      <form class="d-flex flex-column gap-3" [formGroup]="manualTransactionFormGroup()!" (ngSubmit)="onSubmit()">
        <div>
          <label class="app-section-title" for="descriptionInput">Descripción</label>
          <input id="descriptionInput" class="app-input" placeholder="Ej: Cena en restaurante" type="text" formControlName="description" />
        </div>
        <div>
          <label class="app-section-title" for="amountInput">Monto</label>
          <div class="position-relative">
            <span class="position-absolute top-50 start-0 translate-middle-y ms-3 text-muted">$</span>
            <input id="amountInput" class="app-input ps-4" placeholder="0.00" type="number" formControlName="amount" />
          </div>
        </div>
        <div>
          <label class="app-section-title" for="categorySelect">Categoría</label>
          <select class="app-select" id="categorySelect" formControlName="categoryId">
            <option *ngFor="let category of categories()" [value]="category.id">{{ category.name }}</option>
          </select>
        </div>
        <div>
          <label class="app-section-title" for="dateInput">Fecha</label>
          <input id="dateInput" class="app-input" type="date" formControlName="date" />
        </div>
        <button class="app-btn-primary" type="submit">Agregar gasto</button>
      </form>
    </div>

    <!-- <div class="app-card">
      <div class="fw-semibold mb-3">Presupuesto semanal</div>
      <div class="d-flex align-items-end gap-2 mb-2">
        <div class="fs-3 fw-semibold">
          {{ transactions().weeklyBudgetUsed | currency: transactions().currency:'symbol':'1.0-0' }}
        </div>
        <div class="text-muted">/ {{ transactions().weeklyBudgetTotal | currency: transactions().currency:'symbol':'1.0-0' }}</div>
      </div>
      <div class="progress bg-surface-2 mb-2" style="height: 8px;">
        <div class="progress-bar bg-success"
          [style.width]="(transactions().weeklyBudgetUsed / transactions().weeklyBudgetTotal) * 100 + '%'"></div>
      </div>
      <div class="text-muted-2 text-end">64% usado · 3 días restantes</div>
    </div> -->
  </div>
</section>


